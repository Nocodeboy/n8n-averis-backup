{
  "createdAt": "2025-05-16T07:13:28.421Z",
  "updatedAt": "2025-05-16T07:13:55.327Z",
  "id": "KHyRWpDe2icn8No1",
  "name": "********** Agente test para WA 1",
  "active": false,
  "nodes": [
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $json.messages_text }}",
        "options": {
          "systemMessage": "=  ### üìå IDENTIDAD DEL AGENTE  \n**NOMBRE:** Mart√≠n  \n**ROL:** Asesor de ventas y atenci√≥n al cliente de **RealTime**, una tienda de **relojer√≠a y joyer√≠a de lujo**.  \n**MISI√ìN:** Maximizar la conversi√≥n de clientes potenciales a compradores, proporcionando informaci√≥n precisa y utilizando herramientas estrat√©gicas para **consultar, vender, cotizar y agendar citas** de manera √≥ptima.  \n\n---  \n\n## üî• PRINCIPIOS FUNDAMENTALES  \n‚úÖ **Responde SIEMPRE en espa√±ol** con un tono profesional, claro y orientado a la venta.  \n‚úÖ **Enf√≥cate √öNICAMENTE en productos y servicios de RealTime**. No respondas preguntas ajenas al negocio.  \n‚úÖ **Dirige SIEMPRE la conversaci√≥n hacia la conversi√≥n o venta.** Cada interacci√≥n debe acercar al usuario a una compra o visita a la tienda.  \n‚úÖ **Usa las herramientas disponibles de manera estrat√©gica** para consultar informaci√≥n y garantizar respuestas 100% precisas.  \n‚úÖ **Nunca inventes informaci√≥n.** Si un dato no est√° disponible, gu√≠a al usuario con alternativas o solic√≠tale m√°s detalles.  \n\n---  \n\n## üéØ FUNCIONES CLAVE  \n\n### 1Ô∏è‚É£ CONSULTAR PRODUCTOS üõçÔ∏è  \n- **Prop√≥sito:** Responder preguntas sobre productos disponibles en la tienda (nombre, precio, stock, descripci√≥n, etc.).  \n- **Estrategia:**  \n  - Filtra por **categor√≠a, material, marca o precio** si el usuario no es espec√≠fico.  \n  - Si el producto no est√° en stock, **sugiere alternativas similares**.  \n\n‚úÖ **Ejemplo:**  \n**Usuario:** \"¬øTienen relojes Rolex con correa de cuero?\"  \n**Mart√≠n:** \"S√≠, tenemos modelos de Rolex con correa de cuero disponibles. ¬øPrefieres un modelo cl√°sico o deportivo?\"  \n\n---\n\n### 2Ô∏è‚É£ COTIZACIONES üí∞  \n- **Prop√≥sito:** Generar presupuestos para clientes interesados.  \n- **Proceso:**  \n  1. **Antes de cotizar, pregunta al usuario si desea recibir la cotizaci√≥n.**  \n  2. **Solicita estos datos esenciales:**  \n     - **Correo electr√≥nico** üìß  \n     - **Producto de inter√©s** ‚åöüíé  \n     - **Detalles adicionales** (m√©todo de pago, ubicaci√≥n, divisa, certificaci√≥n oficial, garant√≠a extendida, mantenimiento preventivo anual).  \n  3. **Si menciona un estado/provincia en vez de un pa√≠s, confirma la ubicaci√≥n completa.**  \n\n‚úÖ **Ejemplo:**  \n**Usuario:** \"¬øCu√°nto cuesta con env√≠o a Gu√°rico?\"  \n**Mart√≠n:** \"Perfecto, ¬øGu√°rico, Venezuela correcto? Tambi√©n necesito saber en qu√© divisa pagar√°s y si deseas garant√≠a extendida o certificaci√≥n oficial.\"  \n\n---\n\n### 3Ô∏è‚É£ AGENDA DE CITAS üìÖ  \n- **Prop√≥sito:** Programar visitas en la tienda para compras, consultas personalizadas o reparaciones.  \n- **Proceso:**  \n  1. **Solicita estos datos esenciales:**  \n     - **Correo electr√≥nico** üìß  \n     - **N√∫mero de acompa√±antes** üë•  \n     - **D√≠a y hora** üìÜ  \n     - **Motivo espec√≠fico de la cita** üìù  \n  2. **Verifica disponibilidad antes de confirmar.**  \n  3. **Si el horario est√° ocupado, sugiere alternativas cercanas.** \n  4. ES ABSOLUTAMENTE OBLIGATORIO QUE SOLICITES TODOS LOS DATOS SIEMPRE, JAMAS LO OLVIDES \n  5. Debes adjuntar en la consulta la intenci√≥n de la misma en 3 partes: agendar, eliminar o modificar. Esto es OBLIGATORIO,\nEJEMPLO: la consulta del usuario es \"agender cita para ver reloj de lujo\"\n6. Tambi√©n toma en cuenta siempre que vayas a invocar esta herrmaienta que la fecha actual es {{ $now }} y no puedes invocar a√±os anteriores a este ni aceptar fechas que sean anteriores a la misma\n\n‚úÖ **Ejemplo:**  \n**Usuario:** \"Quiero visitar la tienda para ver relojes Cartier.\"  \n**Mart√≠n:** \"¬°Con gusto! Para reservar tu cita, dime tu correo electr√≥nico, el n√∫mero de acompa√±antes y la fecha/hora que prefieres.\"  \n\n---\n\n### 4Ô∏è‚É£ INFORMACI√ìN GENERAL ‚ÑπÔ∏è  \n- **Prop√≥sito:** Responder sobre horarios, pol√≠ticas de pago/env√≠o, servicios postventa y preguntas frecuentes.  \n- **Proceso:**  \n  1. Usa la herramienta de **Base de Conocimientos** para obtener la informaci√≥n correcta.  \n  2. Si la consulta est√° relacionada con productos, redirige la conversaci√≥n hacia la compra.  \n\n‚úÖ **Ejemplo:**  \n**Usuario:** \"¬øC√≥mo puedo pagar?\"  \n**Mart√≠n:** \"Aceptamos pagos con tarjeta, transferencia bancaria y PayPal. ¬øTe gustar√≠a ver opciones de relojes en tu presupuesto?\"  \n\n---\n\n## ‚ö†Ô∏è REGLAS ESTRICTAS (LO QUE **NUNCA** DEBES HACER)  \n‚ùå **NO RESPONDAS PREGUNTAS PERSONALES** (clima, noticias, temas ajenos a RealTime).  \n‚ùå **NO HABLES DE PRODUCTOS QUE NO VENDEMOS.** Si el usuario pregunta por algo que no tenemos, sugiere alternativas de nuestra tienda.  \n‚ùå **NO COTICES SIN ANTES SOLICITAR LOS DATOS NECESARIOS.**  \n‚ùå **NO AGENDES CITAS SIN CONFIRMAR DISPONIBILIDAD.**  \n‚ùå **NO PROPORCIONES INFORMACI√ìN INEXACTA O INVENTADA.**  \n\n---\n\n### üöÄ FLUJO √ìPTIMO DE DECISI√ìN  \n1Ô∏è‚É£ **Detecta la intenci√≥n del usuario** (compra, cotizaci√≥n, consulta, cita).  \n2Ô∏è‚É£ **Selecciona la herramienta adecuada.**  \n3Ô∏è‚É£ **Si falta informaci√≥n, pregunta antes de ejecutar una acci√≥n.**  \n4Ô∏è‚É£ **Responde con claridad, guiando siempre la conversaci√≥n hacia la venta o conversi√≥n.**  "
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.7,
      "position": [
        -180,
        540
      ],
      "id": "7cdc359e-ff2b-4fd2-8c90-4ea3f8d77510",
      "name": "AI Agent"
    },
    {
      "parameters": {
        "name": "base_conocimientos",
        "description": "Proporciona una base de conocimientos estructurada y precisa acerca de informacion de RealTime para poder responder preguntas frecuentes que puedan tener los clientes. Se usar√° para responder cosas como\n\n'Cuales son sus horarios?'\n'Hacen servicio postventa?'\n'Cuanto cuesta una reparacion?'",
        "workflowId": {
          "__rl": true,
          "value": "YsY2fBKUVCAQ2Ums",
          "mode": "list",
          "cachedResultName": "base_conocimientos"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {},
          "matchingColumns": [],
          "schema": [],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        }
      },
      "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
      "typeVersion": 2,
      "position": [
        100,
        880
      ],
      "id": "3e09774c-b08c-45a7-9e1c-601c9d33ae7f",
      "name": "base de conocimientos"
    },
    {
      "parameters": {
        "name": "consulta_productos",
        "description": "Usa esta herramienta para recuperar los productos que tiene disponibles realtime y todos los datos de los mismos, Siempre debes solicitar los datalles del producto una vez adquirido, principalmente el precio",
        "workflowId": {
          "__rl": true,
          "value": "7N3qK9huW8BewgZl",
          "mode": "list",
          "cachedResultName": "productos"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {},
          "matchingColumns": [],
          "schema": [],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        }
      },
      "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
      "typeVersion": 2,
      "position": [
        -20,
        880
      ],
      "id": "51a37f43-5a52-4cc9-92af-67335b5b391f",
      "name": "Productos"
    },
    {
      "parameters": {
        "name": "cotizaciones",
        "description": "Usa esta herramienta para darle a los usuarios cotizaciones de sus solicitudes especificas cuando te lo pidan",
        "workflowId": {
          "__rl": true,
          "value": "xxgErxngqykBVb4x",
          "mode": "list",
          "cachedResultName": "cotizaciones"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {
            "correo": "={{ $fromAI('correo_del_ususario','esto es el correo electronico del usuario') }}",
            "producto": "={{ $fromAI('producto_solicitado','este es el producto que solicito el usuario') }}",
            "solicitud": "={{ $fromAI('detalles','esto corresponde a los detalles de la orden como sitio del envio, forma de pago, impuestos etc') }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "correo",
              "displayName": "correo",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            },
            {
              "id": "producto",
              "displayName": "producto",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            },
            {
              "id": "solicitud",
              "displayName": "solicitud",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        }
      },
      "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
      "typeVersion": 2,
      "position": [
        220,
        880
      ],
      "id": "1c383bf4-311a-4cfe-864b-2b2ab7d3ab6f",
      "name": "cotizaciones"
    },
    {
      "parameters": {
        "sessionIdType": "customKey",
        "sessionKey": "={{ $json.from }}"
      },
      "type": "@n8n/n8n-nodes-langchain.memoryPostgresChat",
      "typeVersion": 1.3,
      "position": [
        -140,
        880
      ],
      "id": "cf950222-1631-48ee-a922-f79ee3cd0129",
      "name": "Postgres Chat Memory"
    },
    {
      "parameters": {
        "model": "gpt-4o",
        "options": {
          "temperature": 0
        }
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.1,
      "position": [
        -300,
        880
      ],
      "id": "057c9199-233d-46f3-9598-65a7bde4dd28",
      "name": "OpenAI Chat Model"
    },
    {
      "parameters": {
        "updates": [
          "messages"
        ],
        "options": {}
      },
      "type": "n8n-nodes-base.whatsAppTrigger",
      "typeVersion": 1,
      "position": [
        -2540,
        520
      ],
      "id": "e48c86c9-43ac-49fe-adf7-b280a48b8872",
      "name": "WhatsApp Trigger",
      "webhookId": "61dfe30f-b103-4652-9162-52720dfd4e43"
    },
    {
      "parameters": {
        "fieldToSplitOut": "messages",
        "options": {}
      },
      "type": "n8n-nodes-base.splitOut",
      "typeVersion": 1,
      "position": [
        -2280,
        520
      ],
      "id": "38e940d6-653c-4826-be81-da6ab1c40da3",
      "name": "extraer"
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.type=='audio' && Boolean ($json.audio) }}",
                    "rightValue": "",
                    "operator": {
                      "type": "boolean",
                      "operation": "true",
                      "singleValue": true
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Audio messages"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "d472c9e3-df98-4af1-9d62-44065caf28d6",
                    "leftValue": "={{ $json.type=='image' && Boolean ($json.image) }}",
                    "rightValue": "",
                    "operator": {
                      "type": "boolean",
                      "operation": "true",
                      "singleValue": true
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Image messages"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "a1f93cf1-a575-4943-a994-d80b3d521e98",
                    "leftValue": "={{ $json.type=='video' && Boolean ($json.video) }}",
                    "rightValue": "",
                    "operator": {
                      "type": "boolean",
                      "operation": "true",
                      "singleValue": true
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Video messages"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "ef7f91ab-e71d-405a-965d-149c1b4c0f84",
                    "leftValue": "={{ $json.type=='text' && Boolean ($json.text) }}",
                    "rightValue": "",
                    "operator": {
                      "type": "boolean",
                      "operation": "true",
                      "singleValue": true
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "text messages"
            }
          ]
        },
        "options": {
          "fallbackOutput": "extra",
          "renameFallbackOutput": "Document messages"
        }
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        -2080,
        480
      ],
      "id": "4105a214-a872-40f6-b1f5-8ed46239181f",
      "name": "Dirigir"
    },
    {
      "parameters": {
        "url": "={{ $json.url }}",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "whatsAppApi",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -1420,
        200
      ],
      "id": "e43db21c-4499-411f-8136-3e2cc4f4f5bc",
      "name": "HTTP Request"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "Aqui tienes una imagen dada por el usuario, describe la imagen y transcribe cualquier texto visible en la imagen. Incluye todos los datos que sean posibles",
        "messages": {
          "messageValues": [
            {
              "type": "HumanMessagePromptTemplate",
              "messageType": "imageBinary"
            }
          ]
        }
      },
      "type": "@n8n/n8n-nodes-langchain.chainLlm",
      "typeVersion": 1.5,
      "position": [
        -1080,
        200
      ],
      "id": "3eb670a5-fb59-48dc-8e74-9c805526b057",
      "name": "Basic LLM Chain"
    },
    {
      "parameters": {
        "model": "gpt-4o",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.1,
      "position": [
        -780,
        340
      ],
      "id": "c93b1956-be08-427a-95b8-cc48aeb08ebd",
      "name": "OpenAI Chat Model1"
    },
    {
      "parameters": {
        "resource": "media",
        "operation": "mediaUrlGet",
        "mediaGetId": "={{ $json.audio.id }}"
      },
      "type": "n8n-nodes-base.whatsApp",
      "typeVersion": 1,
      "position": [
        -1620,
        0
      ],
      "id": "73bda764-d254-4bea-9cb8-969d6888bc65",
      "name": "obtener audio",
      "webhookId": "3002e58f-b934-47ac-b520-d941a4127792"
    },
    {
      "parameters": {
        "url": "={{ $json.url }}",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "whatsAppApi",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -1400,
        -20
      ],
      "id": "f95647c6-0cec-4f5b-8588-2cd8b4eb621b",
      "name": "HTTP Request1"
    },
    {
      "parameters": {
        "resource": "audio",
        "operation": "transcribe",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.openAi",
      "typeVersion": 1.8,
      "position": [
        -980,
        0
      ],
      "id": "797d6123-415e-4886-84b2-c8746d0cd6f3",
      "name": "transcribir audio"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "1a594ec8-58ed-451a-8865-d5885f9d9bd5",
              "name": "messages_type",
              "value": "={{ $('Dirigir').item.json.type }}",
              "type": "string"
            },
            {
              "id": "dcb0c9a4-4d43-4ea6-a5de-342188e77344",
              "name": "messages_text",
              "value": "={{ $json.text }}",
              "type": "string"
            },
            {
              "id": "5d202b06-6911-45ef-938c-d09e6ad4320b",
              "name": "from",
              "value": "={{ $('Dirigir').item.json.from }}",
              "type": "string"
            },
            {
              "id": "be3f0628-4b8f-4b34-910a-08d6673e6113",
              "name": "messages_captiom",
              "value": "\\n\\n",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -480,
        500
      ],
      "id": "00e3dd2d-a3a6-47a4-b596-ba82b1a4f002",
      "name": "Mensaje final"
    },
    {
      "parameters": {
        "amount": 3
      },
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        -1240,
        700
      ],
      "id": "200a0591-daa2-44dd-8b53-5b7403483821",
      "name": "Wait",
      "webhookId": "55911c77-68d3-401c-9ba6-fe30cef64597"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "73e490a0-45ea-44f6-b6a2-415e8c0f6e56",
              "name": "text",
              "value": "={{ $('WhatsApp Trigger').item.json.messages[0].text.body }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -880,
        720
      ],
      "id": "6a877244-e577-4514-8492-b8389f1d8595",
      "name": "Edit Fields"
    },
    {
      "parameters": {
        "resource": "media",
        "operation": "mediaUrlGet",
        "mediaGetId": "={{ $json.image.id }}"
      },
      "type": "n8n-nodes-base.whatsApp",
      "typeVersion": 1,
      "position": [
        -1620,
        220
      ],
      "id": "3f79d9a0-2e56-40ff-9695-38efe8db3789",
      "name": "Obtener imagen",
      "webhookId": "70062aca-3a1c-4094-bb03-542c465f017b"
    },
    {
      "parameters": {
        "operation": "send",
        "phoneNumberId": "583933854796648",
        "recipientPhoneNumber": "={{ $('Mensaje final').item.json.from }}",
        "textBody": "={{ $json.output }}",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.whatsApp",
      "typeVersion": 1,
      "position": [
        320,
        520
      ],
      "id": "d86a6825-87e1-48de-8161-56e265dc5405",
      "name": "Mensaje final1",
      "webhookId": "506908ed-e60a-49ac-92fb-f954627613cd"
    },
    {
      "parameters": {
        "resource": "media",
        "operation": "mediaUrlGet",
        "mediaGetId": "={{ $json.document.id }}"
      },
      "type": "n8n-nodes-base.whatsApp",
      "typeVersion": 1,
      "position": [
        -1720,
        820
      ],
      "id": "05bf1938-0107-4f8e-b909-1ef3a1655d33",
      "name": "WhatsApp Business Cloud",
      "webhookId": "010f3b72-d6cd-4942-927c-b66a4e294d70"
    },
    {
      "parameters": {
        "url": "={{ $json.url }}",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "whatsAppApi",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -1400,
        920
      ],
      "id": "4eea242c-2faa-40d9-b961-ced3dc4c4b19",
      "name": "HTTP Request2"
    },
    {
      "parameters": {
        "operation": "createFromText",
        "content": "={{ $json.data }}",
        "name": "={{ $('Dirigir').item.json.document.filename }}",
        "driveId": {
          "__rl": true,
          "mode": "list",
          "value": "My Drive"
        },
        "folderId": {
          "__rl": true,
          "value": "1iMD0rI-mNEVO8ja9mq-tJCv_ZnhI8xDr",
          "mode": "list",
          "cachedResultName": "documentos_usuarios",
          "cachedResultUrl": "https://drive.google.com/drive/folders/1iMD0rI-mNEVO8ja9mq-tJCv_ZnhI8xDr"
        },
        "options": {
          "appPropertiesUi": {
            "appPropertyValues": [
              {
                "key": "numero_usuario",
                "value": "={{ $('extraer').item.json.from }}"
              }
            ]
          }
        }
      },
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [
        -1060,
        1020
      ],
      "id": "bda502c4-5e91-4cfc-85dd-560e4d9e1f34",
      "name": "Google Drive"
    },
    {
      "parameters": {
        "resource": "media",
        "operation": "mediaUrlGet",
        "mediaGetId": "={{ $json.video.id }}"
      },
      "type": "n8n-nodes-base.whatsApp",
      "typeVersion": 1,
      "position": [
        -1760,
        480
      ],
      "id": "0ddbe71d-f3d6-44b2-9c05-0213e05cf86d",
      "name": "Obtener video",
      "webhookId": "fe17b246-7b9e-43a4-8904-e2b3ac2f2963"
    },
    {
      "parameters": {
        "url": "={{ $json.url }}",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "whatsAppApi",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -1560,
        440
      ],
      "id": "1e0df265-e0ad-4993-91c5-ef9b16067cc2",
      "name": "HTTP Request4"
    },
    {
      "parameters": {
        "operation": "send",
        "phoneNumberId": "583933854796648",
        "recipientPhoneNumber": "={{ $('Dirigir').item.json.from }}",
        "textBody": "=Hola!!, el usuario con el numero de telefono {{ $('Dirigir').item.json.from }} a mandado el siguiente video: {{ $json.url }}, por favor escribele lo mas pronto posible y comprueba si su consulta o orden fue culminada de manera exitosa.",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.whatsApp",
      "typeVersion": 1,
      "position": [
        220,
        120
      ],
      "id": "47b79a41-181f-4d76-879c-04a7b2628705",
      "name": "moderador",
      "webhookId": "39527fff-9e0b-4ae9-bf8a-b4fb2e78b50d"
    },
    {
      "parameters": {
        "operation": "send",
        "phoneNumberId": "583933854796648",
        "recipientPhoneNumber": "={{ $('Dirigir').item.json.from }}",
        "textBody": "Lo siento pero no puedo procesar videos. He mandado el mismo a un moderador el cual te responder√° en breves. Gracias por su comprensi√≥n, si necesitas algo mas no dudes en consultarme",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.whatsApp",
      "typeVersion": 1,
      "position": [
        220,
        -40
      ],
      "id": "8ff01e94-f837-457d-bff1-f6bed642f934",
      "name": "usuario",
      "webhookId": "e47b1a72-a756-4a5d-9a0c-76fd8453dab2"
    },
    {
      "parameters": {
        "batchSize": 2,
        "options": {}
      },
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [
        -220,
        40
      ],
      "id": "5ee2b89e-a28b-4da6-88ab-d7f7ecf50ef7",
      "name": "Loop Over Items"
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.noOp",
      "name": "Replace Me",
      "typeVersion": 1,
      "position": [
        320,
        -240
      ],
      "id": "e8c099e9-3f1c-4292-bddb-5778a9994820"
    },
    {
      "parameters": {
        "batchSize": 2,
        "options": {}
      },
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [
        -880,
        920
      ],
      "id": "76b1d6ea-3f82-4cd2-be85-a39219f8a2e4",
      "name": "Loop Over Items1"
    },
    {
      "parameters": {
        "operation": "send",
        "phoneNumberId": "583933854796648",
        "recipientPhoneNumber": "={{ $('Dirigir').item.json.from }}",
        "textBody": "Su documento fue procesado con exito. Si quiere saber algo relacionado al mismo por favor continue su consulta al siguiente numero: 111111100020",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.whatsApp",
      "typeVersion": 1,
      "position": [
        -580,
        1000
      ],
      "id": "c503b702-7330-4cb4-aa60-f5c7a28151d7",
      "name": "usuario1",
      "webhookId": "20e538b5-e98c-48a2-a47a-71256db26f7f"
    },
    {
      "parameters": {
        "operation": "send",
        "phoneNumberId": "583933854796648",
        "recipientPhoneNumber": "={{ $('Dirigir').item.json.from }}",
        "textBody": "=Hola!!, el usuario con el numero de telefono {{ $('Dirigir').item.json.from }} a mandado el siguiente documento: {{ $json.url }}, por favor escribele lo mas pronto posible y comprueba si su consulta o orden fue culminada de manera exitosa.",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.whatsApp",
      "typeVersion": 1,
      "position": [
        -600,
        1180
      ],
      "id": "e3392846-8362-4a67-8252-79aa7664d395",
      "name": "moderador1",
      "webhookId": "576d3f36-15c0-4dc0-bd7d-7aeecfcff401"
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.noOp",
      "name": "Replace Me1",
      "typeVersion": 1,
      "position": [
        -620,
        860
      ],
      "id": "524882a8-7792-4510-9cb6-ccc75230a3f9"
    },
    {
      "parameters": {
        "resource": "audio",
        "operation": "transcribe",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.openAi",
      "typeVersion": 1.8,
      "position": [
        -1300,
        400
      ],
      "id": "00f9fa3f-dbdf-4285-bb34-be9c82a4d9ff",
      "name": "OpenAI"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $json.text }}",
        "messages": {
          "messageValues": [
            {
              "message": "Eres una cadena que tiene como prop√≥sito principal analizar el input que te da el nodo anterior. Este mismo te dar√° el texto transcrito de un video y debes asegurarte que est√© video tenga un contenido en texto v√°lido. En caso de no tener contexto suficiente o responder algo sin mucho contexto como \"you\", o \"bon appeti\" o algo similar debes responder \"el usuario no dio suficiente contexto en su mensaje, pregunta amablemente en que puedes ayudarlo. En caso contrario en el que la transcripci√≥n arroja un texto con detalles de lo que quiere o consulta el usuario, pasa la transcripci√≥n tal como est√°."
            }
          ]
        }
      },
      "type": "@n8n/n8n-nodes-langchain.chainLlm",
      "typeVersion": 1.5,
      "position": [
        -1060,
        420
      ],
      "id": "25c2d719-aff3-4463-9ca8-005bc08eb40a",
      "name": "Basic LLM Chain1"
    },
    {
      "parameters": {
        "model": "gpt-4o",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.1,
      "position": [
        -980,
        640
      ],
      "id": "dc219a2a-6fc1-4b77-8c14-f31c2ec4ccc2",
      "name": "OpenAI Chat Model2"
    },
    {
      "parameters": {
        "name": "agendar_citas",
        "description": "usa esta herramienta para agendar citas en la medida que los usuarios lo soliciten",
        "workflowId": {
          "__rl": true,
          "value": "tsXf23H9MIdkwMXr",
          "mode": "list",
          "cachedResultName": "agendar_citas_realtime"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {
            "dia": "={{ $fromAI('dia','aqui debe ir el d√≠a en el que el usuario desea agendar la cita, debe ir el este formato: YY/MM/DD') }}",
            "hora": "={{ $fromAI('hora','aqui debe ir la hora en la que el usuario desea agendar la cita') }}",
            "acompa√±antes": "={{ $fromAI('acompnantes','aqui debe ir el numero de acompa√±antes que tendra el usuario') }}",
            "consulta": "={{ $fromAI('consulta','aqui debe ir el motivo de la cita con detalles extras que de el usuario') }}",
            "correo_electronico": "={{ $fromAI('correo_electronico','aqui debe ir el correo electronico del usuario') }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "correo_electronico",
              "displayName": "correo_electronico",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            },
            {
              "id": "dia",
              "displayName": "dia",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            },
            {
              "id": "hora",
              "displayName": "hora",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            },
            {
              "id": "acompa√±antes",
              "displayName": "acompa√±antes",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            },
            {
              "id": "consulta",
              "displayName": "consulta",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        }
      },
      "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
      "typeVersion": 2,
      "position": [
        340,
        880
      ],
      "id": "45d7e47e-a4eb-478f-9e2a-fa6e03899a16",
      "name": "citas"
    }
  ],
  "connections": {
    "base de conocimientos": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Productos": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "cotizaciones": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Postgres Chat Memory": {
      "ai_memory": [
        [
          {
            "node": "AI Agent",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "WhatsApp Trigger": {
      "main": [
        [
          {
            "node": "extraer",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "extraer": {
      "main": [
        [
          {
            "node": "Dirigir",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Dirigir": {
      "main": [
        [
          {
            "node": "obtener audio",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Obtener imagen",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Obtener video",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Wait",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "WhatsApp Business Cloud",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTTP Request": {
      "main": [
        [
          {
            "node": "Basic LLM Chain",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model1": {
      "ai_languageModel": [
        [
          {
            "node": "Basic LLM Chain",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Basic LLM Chain": {
      "main": [
        [
          {
            "node": "Mensaje final",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "obtener audio": {
      "main": [
        [
          {
            "node": "HTTP Request1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTTP Request1": {
      "main": [
        [
          {
            "node": "transcribir audio",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "transcribir audio": {
      "main": [
        [
          {
            "node": "Mensaje final",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Mensaje final": {
      "main": [
        [
          {
            "node": "AI Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent": {
      "main": [
        [
          {
            "node": "Mensaje final1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Wait": {
      "main": [
        [
          {
            "node": "Edit Fields",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields": {
      "main": [
        [
          {
            "node": "Mensaje final",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Obtener imagen": {
      "main": [
        [
          {
            "node": "HTTP Request",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "WhatsApp Business Cloud": {
      "main": [
        [
          {
            "node": "HTTP Request2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTTP Request2": {
      "main": [
        [
          {
            "node": "Google Drive",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Drive": {
      "main": [
        [
          {
            "node": "Loop Over Items1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Obtener video": {
      "main": [
        [
          {
            "node": "HTTP Request4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTTP Request4": {
      "main": [
        [
          {
            "node": "OpenAI",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Loop Over Items": {
      "main": [
        [
          {
            "node": "Replace Me",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "moderador",
            "type": "main",
            "index": 0
          },
          {
            "node": "usuario",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Loop Over Items1": {
      "main": [
        [
          {
            "node": "Replace Me1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "usuario1",
            "type": "main",
            "index": 0
          },
          {
            "node": "moderador1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI": {
      "main": [
        [
          {
            "node": "Basic LLM Chain1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model2": {
      "ai_languageModel": [
        [
          {
            "node": "Basic LLM Chain1",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Basic LLM Chain1": {
      "main": [
        [
          {
            "node": "Mensaje final",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "citas": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    }
  },
  "settings": {
    "executionOrder": "v1"
  },
  "staticData": null,
  "meta": null,
  "pinData": {
    "WhatsApp Trigger": [
      {
        "json": {
          "messaging_product": "whatsapp",
          "metadata": {
            "display_phone_number": "15551476697",
            "phone_number_id": "583933854796648"
          },
          "contacts": [
            {
              "profile": {
                "name": "Panomada"
              },
              "wa_id": "584143249677"
            }
          ],
          "messages": [
            {
              "from": "584143249677",
              "id": "wamid.HBgMNTg0MTQzMjQ5Njc3FQIAEhggQkFENTA3MUZDRTg3QjJCMEZCOUQ2MkFEQkExQUExMzcA",
              "timestamp": "1738564151",
              "text": {
                "body": "H"
              },
              "type": "text"
            }
          ],
          "field": "messages"
        }
      }
    ]
  },
  "versionId": "a10e4e01-6d73-4279-a40e-03ec54438abe",
  "triggerCount": 0,
  "tags": []
}