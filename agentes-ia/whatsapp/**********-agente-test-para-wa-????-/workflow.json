{
  "createdAt": "2025-05-16T07:14:29.484Z",
  "updatedAt": "2025-05-16T07:14:55.894Z",
  "id": "IeQ0SuQxQ0a68P2m",
  "name": "********** Agente test para WA ????",
  "active": false,
  "nodes": [
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $json.messages_text }}",
        "options": {
          "systemMessage": "=  ### üìå IDENTIDAD DEL AGENTE  \n**NOMBRE:** Mart√≠n  \n**ROL:** Asesor de ventas y atenci√≥n al cliente de **RealTime**, una tienda de **relojer√≠a y joyer√≠a de lujo**.  \n**MISI√ìN:** Maximizar la conversi√≥n de clientes potenciales a compradores, proporcionando informaci√≥n precisa y utilizando herramientas estrat√©gicas para **consultar, vender, cotizar y agendar citas** de manera √≥ptima.  \n\n---  \n\n## üî• PRINCIPIOS FUNDAMENTALES  \n‚úÖ **Responde SIEMPRE en espa√±ol** con un tono profesional, claro y orientado a la venta.  \n‚úÖ **Enf√≥cate √öNICAMENTE en productos y servicios de RealTime**. No respondas preguntas ajenas al negocio.  \n‚úÖ **Dirige SIEMPRE la conversaci√≥n hacia la conversi√≥n o venta.** Cada interacci√≥n debe acercar al usuario a una compra o visita a la tienda.  \n‚úÖ **Usa las herramientas disponibles de manera estrat√©gica** para consultar informaci√≥n y garantizar respuestas 100% precisas.  \n‚úÖ **Nunca inventes informaci√≥n.** Si un dato no est√° disponible, gu√≠a al usuario con alternativas o solic√≠tale m√°s detalles.  \n\n---  \n\n## üéØ FUNCIONES CLAVE  \n\n### 1Ô∏è‚É£ CONSULTAR PRODUCTOS üõçÔ∏è  \n- **Prop√≥sito:** Responder preguntas sobre productos disponibles en la tienda (nombre, precio, stock, descripci√≥n, etc.).  \n- **Estrategia:**  \n  - Filtra por **categor√≠a, material, marca o precio** si el usuario no es espec√≠fico.  \n  - Si el producto no est√° en stock, **sugiere alternativas similares**.  \n\n‚úÖ **Ejemplo:**  \n**Usuario:** \"¬øTienen relojes Rolex con correa de cuero?\"  \n**Mart√≠n:** \"S√≠, tenemos modelos de Rolex con correa de cuero disponibles. ¬øPrefieres un modelo cl√°sico o deportivo?\"  \n\n---\n\n### 2Ô∏è‚É£ COTIZACIONES üí∞  \n- **Prop√≥sito:** Generar presupuestos para clientes interesados.  \n- **Proceso:**  \n  1. **Antes de cotizar, pregunta al usuario si desea recibir la cotizaci√≥n.**  \n  2. **Solicita estos datos esenciales:**  \n     - **Correo electr√≥nico** üìß  \n     - **Producto de inter√©s** ‚åöüíé  \n     - **Detalles adicionales** (m√©todo de pago, ubicaci√≥n, divisa, certificaci√≥n oficial, garant√≠a extendida, mantenimiento preventivo anual).  \n  3. **Si menciona un estado/provincia en vez de un pa√≠s, confirma la ubicaci√≥n completa.**  \n\n‚úÖ **Ejemplo:**  \n**Usuario:** \"¬øCu√°nto cuesta con env√≠o a Gu√°rico?\"  \n**Mart√≠n:** \"Perfecto, ¬øGu√°rico, Venezuela correcto? Tambi√©n necesito saber en qu√© divisa pagar√°s y si deseas garant√≠a extendida o certificaci√≥n oficial.\"  \n\n---\n\n### 3Ô∏è‚É£ AGENDA DE CITAS üìÖ  \n- **Prop√≥sito:** Programar visitas en la tienda para compras, consultas personalizadas o reparaciones.  \n- **Proceso:**  \n  1. **Solicita estos datos esenciales:**  \n     - **Correo electr√≥nico** üìß  \n     - **N√∫mero de acompa√±antes** üë•  \n     - **D√≠a y hora** üìÜ  \n     - **Motivo espec√≠fico de la cita** üìù  \n  2. **Verifica disponibilidad antes de confirmar.**  \n  3. **Si el horario est√° ocupado, sugiere alternativas cercanas.** \n  4. ES ABSOLUTAMENTE OBLIGATORIO QUE SOLICITES TODOS LOS DATOS SIEMPRE, JAMAS LO OLVIDES \n  5. Debes adjuntar en la consulta la intenci√≥n de la misma en 3 partes: agendar, eliminar o modificar. Esto es OBLIGATORIO,\nEJEMPLO: la consulta del usuario es \"agender cita para ver reloj de lujo\"\n6. Tambi√©n toma en cuenta siempre que vayas a invocar esta herrmaienta que la fecha actual es {{ $now }} y no puedes invocar a√±os anteriores a este ni aceptar fechas que sean anteriores a la misma\n\n‚úÖ **Ejemplo:**  \n**Usuario:** \"Quiero visitar la tienda para ver relojes Cartier.\"  \n**Mart√≠n:** \"¬°Con gusto! Para reservar tu cita, dime tu correo electr√≥nico, el n√∫mero de acompa√±antes y la fecha/hora que prefieres.\"  \n\n---\n\n### 4Ô∏è‚É£ INFORMACI√ìN GENERAL ‚ÑπÔ∏è  \n- **Prop√≥sito:** Responder sobre horarios, pol√≠ticas de pago/env√≠o, servicios postventa y preguntas frecuentes.  \n- **Proceso:**  \n  1. Usa la herramienta de **Base de Conocimientos** para obtener la informaci√≥n correcta.  \n  2. Si la consulta est√° relacionada con productos, redirige la conversaci√≥n hacia la compra.  \n\n‚úÖ **Ejemplo:**  \n**Usuario:** \"¬øC√≥mo puedo pagar?\"  \n**Mart√≠n:** \"Aceptamos pagos con tarjeta, transferencia bancaria y PayPal. ¬øTe gustar√≠a ver opciones de relojes en tu presupuesto?\"  \n\n---\n\n## ‚ö†Ô∏è REGLAS ESTRICTAS (LO QUE **NUNCA** DEBES HACER)  \n‚ùå **NO RESPONDAS PREGUNTAS PERSONALES** (clima, noticias, temas ajenos a RealTime).  \n‚ùå **NO HABLES DE PRODUCTOS QUE NO VENDEMOS.** Si el usuario pregunta por algo que no tenemos, sugiere alternativas de nuestra tienda.  \n‚ùå **NO COTICES SIN ANTES SOLICITAR LOS DATOS NECESARIOS.**  \n‚ùå **NO AGENDES CITAS SIN CONFIRMAR DISPONIBILIDAD.**  \n‚ùå **NO PROPORCIONES INFORMACI√ìN INEXACTA O INVENTADA.**  \n\n---\n\n### üöÄ FLUJO √ìPTIMO DE DECISI√ìN  \n1Ô∏è‚É£ **Detecta la intenci√≥n del usuario** (compra, cotizaci√≥n, consulta, cita).  \n2Ô∏è‚É£ **Selecciona la herramienta adecuada.**  \n3Ô∏è‚É£ **Si falta informaci√≥n, pregunta antes de ejecutar una acci√≥n.**  \n4Ô∏è‚É£ **Responde con claridad, guiando siempre la conversaci√≥n hacia la venta o conversi√≥n.**  "
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.7,
      "position": [
        1580,
        460
      ],
      "id": "39d8d1a5-4b6e-49e7-b7a3-1d632299c2c3",
      "name": "AI Agent"
    },
    {
      "parameters": {
        "name": "base_conocimientos",
        "description": "Proporciona una base de conocimientos estructurada y precisa acerca de informacion de RealTime para poder responder preguntas frecuentes que puedan tener los clientes. Se usar√° para responder cosas como\n\n'Cuales son sus horarios?'\n'Hacen servicio postventa?'\n'Cuanto cuesta una reparacion?'",
        "workflowId": {
          "__rl": true,
          "value": "YsY2fBKUVCAQ2Ums",
          "mode": "list",
          "cachedResultName": "base_conocimientos"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {},
          "matchingColumns": [],
          "schema": [],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        }
      },
      "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
      "typeVersion": 2,
      "position": [
        1860,
        780
      ],
      "id": "81c45a43-eec9-4c23-8b15-0d1b60ff526d",
      "name": "base de conocimientos"
    },
    {
      "parameters": {
        "name": "consulta_productos",
        "description": "Usa esta herramienta para recuperar los productos que tiene disponibles realtime y todos los datos de los mismos, Siempre debes solicitar los datalles del producto una vez adquirido, principalmente el precio",
        "workflowId": {
          "__rl": true,
          "value": "7N3qK9huW8BewgZl",
          "mode": "list",
          "cachedResultName": "productos"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {},
          "matchingColumns": [],
          "schema": [],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        }
      },
      "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
      "typeVersion": 2,
      "position": [
        1720,
        780
      ],
      "id": "6e2fd21f-be03-4f6d-84fe-894a046a3702",
      "name": "Productos"
    },
    {
      "parameters": {
        "name": "cotizaciones",
        "description": "Usa esta herramienta para darle a los usuarios cotizaciones de sus solicitudes especificas cuando te lo pidan",
        "workflowId": {
          "__rl": true,
          "value": "xxgErxngqykBVb4x",
          "mode": "list",
          "cachedResultName": "cotizaciones"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {
            "correo": "={{ $fromAI('correo_del_ususario','esto es el correo electronico del usuario') }}",
            "producto": "={{ $fromAI('producto_solicitado','este es el producto que solicito el usuario') }}",
            "solicitud": "={{ $fromAI('detalles','esto corresponde a los detalles de la orden como sitio del envio, forma de pago, impuestos etc') }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "correo",
              "displayName": "correo",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            },
            {
              "id": "producto",
              "displayName": "producto",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            },
            {
              "id": "solicitud",
              "displayName": "solicitud",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        }
      },
      "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
      "typeVersion": 2,
      "position": [
        2000,
        780
      ],
      "id": "840dde81-451a-486c-a752-1ee2d07e0cbc",
      "name": "cotizaciones"
    },
    {
      "parameters": {
        "sessionIdType": "customKey",
        "sessionKey": "={{ $json.from }}"
      },
      "type": "@n8n/n8n-nodes-langchain.memoryPostgresChat",
      "typeVersion": 1.3,
      "position": [
        1560,
        780
      ],
      "id": "e7e8bd58-4fb8-497e-a307-1c419603ad3f",
      "name": "Postgres Chat Memory"
    },
    {
      "parameters": {
        "model": "gpt-4o",
        "options": {
          "temperature": 0
        }
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.1,
      "position": [
        1400,
        780
      ],
      "id": "b3635c20-0a51-4bce-855a-4c9e3b97fba5",
      "name": "OpenAI Chat Model"
    },
    {
      "parameters": {
        "updates": [
          "messages"
        ],
        "options": {}
      },
      "type": "n8n-nodes-base.whatsAppTrigger",
      "typeVersion": 1,
      "position": [
        -780,
        420
      ],
      "id": "81fd4318-78d0-4195-ae3e-959f33fbfc0b",
      "name": "WhatsApp Trigger",
      "webhookId": "61dfe30f-b103-4652-9162-52720dfd4e43"
    },
    {
      "parameters": {
        "fieldToSplitOut": "messages",
        "options": {}
      },
      "type": "n8n-nodes-base.splitOut",
      "typeVersion": 1,
      "position": [
        -520,
        420
      ],
      "id": "5dca16b0-fb18-457c-952d-2db8135e5f72",
      "name": "extraer"
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.type=='audio' && Boolean ($json.audio) }}",
                    "rightValue": "",
                    "operator": {
                      "type": "boolean",
                      "operation": "true",
                      "singleValue": true
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Audio messages"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "d472c9e3-df98-4af1-9d62-44065caf28d6",
                    "leftValue": "={{ $json.type=='image' && Boolean ($json.image) }}",
                    "rightValue": "",
                    "operator": {
                      "type": "boolean",
                      "operation": "true",
                      "singleValue": true
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Image messages"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "a1f93cf1-a575-4943-a994-d80b3d521e98",
                    "leftValue": "={{ $json.type=='video' && Boolean ($json.video) }}",
                    "rightValue": "",
                    "operator": {
                      "type": "boolean",
                      "operation": "true",
                      "singleValue": true
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Video messages"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "ef7f91ab-e71d-405a-965d-149c1b4c0f84",
                    "leftValue": "={{ $json.type=='text' && Boolean ($json.text) }}",
                    "rightValue": "",
                    "operator": {
                      "type": "boolean",
                      "operation": "true",
                      "singleValue": true
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "text messages"
            }
          ]
        },
        "options": {
          "fallbackOutput": "extra",
          "renameFallbackOutput": "Document messages"
        }
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        -320,
        380
      ],
      "id": "d7a94fdd-1241-4c05-8e76-984513baade0",
      "name": "Dirigir"
    },
    {
      "parameters": {
        "url": "={{ $json.url }}",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "whatsAppApi",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        340,
        100
      ],
      "id": "2543af86-1a3d-4b42-be9b-f1db96524f2f",
      "name": "HTTP Request"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "Aqui tienes una imagen dada por el usuario, describe la imagen y transcribe cualquier texto visible en la imagen. Incluye todos los datos que sean posibles",
        "messages": {
          "messageValues": [
            {
              "type": "HumanMessagePromptTemplate",
              "messageType": "imageBinary"
            }
          ]
        }
      },
      "type": "@n8n/n8n-nodes-langchain.chainLlm",
      "typeVersion": 1.5,
      "position": [
        680,
        100
      ],
      "id": "897cfa10-d8bf-4927-a42a-2f93c997bd9e",
      "name": "Basic LLM Chain"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.1,
      "position": [
        980,
        240
      ],
      "id": "5f04ee2a-653b-44b6-a81e-def24e887f1a",
      "name": "OpenAI Chat Model1"
    },
    {
      "parameters": {
        "resource": "media",
        "operation": "mediaUrlGet",
        "mediaGetId": "={{ $json.audio.id }}"
      },
      "type": "n8n-nodes-base.whatsApp",
      "typeVersion": 1,
      "position": [
        140,
        -100
      ],
      "id": "4b8a7eaa-24e8-406c-96e4-598d8c581ed8",
      "name": "obtener audio",
      "webhookId": "042527e1-33e7-4064-8145-d62f6f894b9a"
    },
    {
      "parameters": {
        "url": "={{ $json.url }}",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "whatsAppApi",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        360,
        -120
      ],
      "id": "2eb6ad26-ea89-43e2-96dd-3f4ddbc2b732",
      "name": "HTTP Request1"
    },
    {
      "parameters": {
        "resource": "audio",
        "operation": "transcribe",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.openAi",
      "typeVersion": 1.8,
      "position": [
        780,
        -100
      ],
      "id": "b77a1cef-1269-4ad0-9b4b-432361d65bea",
      "name": "transcribir audio"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "1a594ec8-58ed-451a-8865-d5885f9d9bd5",
              "name": "messages_type",
              "value": "={{ $('Dirigir').item.json.type }}",
              "type": "string"
            },
            {
              "id": "dcb0c9a4-4d43-4ea6-a5de-342188e77344",
              "name": "messages_text",
              "value": "={{ $json.text }}",
              "type": "string"
            },
            {
              "id": "5d202b06-6911-45ef-938c-d09e6ad4320b",
              "name": "from",
              "value": "={{ $('Dirigir').item.json.from }}",
              "type": "string"
            },
            {
              "id": "be3f0628-4b8f-4b34-910a-08d6673e6113",
              "name": "messages_captiom",
              "value": "\\n\\n",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        1280,
        420
      ],
      "id": "1961c4bb-e770-472b-98b8-5724c403ac22",
      "name": "Mensaje final"
    },
    {
      "parameters": {
        "amount": 3
      },
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        520,
        600
      ],
      "id": "5fbc489d-369e-41ae-b14b-f4bdec6ad003",
      "name": "Wait",
      "webhookId": "55911c77-68d3-401c-9ba6-fe30cef64597"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "73e490a0-45ea-44f6-b6a2-415e8c0f6e56",
              "name": "text",
              "value": "={{ $('WhatsApp Trigger').item.json.messages[0].text.body }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        900,
        620
      ],
      "id": "4ff25e31-091c-48a9-a8b2-3083a4bf88c9",
      "name": "Edit Fields"
    },
    {
      "parameters": {
        "resource": "media",
        "operation": "mediaUrlGet",
        "mediaGetId": "={{ $json.image.id }}"
      },
      "type": "n8n-nodes-base.whatsApp",
      "typeVersion": 1,
      "position": [
        140,
        120
      ],
      "id": "066e5d1d-b70c-4428-af7d-9299f62ebac6",
      "name": "Obtener imagen",
      "webhookId": "c67b898b-9bd9-43ba-8546-871aa51b6ed3"
    },
    {
      "parameters": {
        "operation": "send",
        "phoneNumberId": "583933854796648",
        "recipientPhoneNumber": "={{ $('Mensaje final').item.json.from }}",
        "textBody": "={{ $json.output }}",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.whatsApp",
      "typeVersion": 1,
      "position": [
        2040,
        440
      ],
      "id": "f2363698-1616-44c4-8ab9-6b4f07f69bb8",
      "name": "Mensaje final1",
      "webhookId": "e9011991-19f5-4699-b184-2867f9a73288"
    },
    {
      "parameters": {
        "resource": "media",
        "operation": "mediaUrlGet",
        "mediaGetId": "={{ $json.document.id }}"
      },
      "type": "n8n-nodes-base.whatsApp",
      "typeVersion": 1,
      "position": [
        40,
        720
      ],
      "id": "cdfc5805-a6fe-46e7-af75-5d7e3cf7bb28",
      "name": "WhatsApp Business Cloud",
      "webhookId": "98747cac-5338-4235-a43a-991206f8d4ac"
    },
    {
      "parameters": {
        "url": "={{ $json.url }}",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "whatsAppApi",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        360,
        820
      ],
      "id": "dd3d0ffa-daac-449e-b9f6-8bd9bd6a3730",
      "name": "HTTP Request2"
    },
    {
      "parameters": {
        "operation": "createFromText",
        "content": "={{ $json.data }}",
        "name": "={{ $('Dirigir').item.json.document.filename }}",
        "driveId": {
          "__rl": true,
          "mode": "list",
          "value": "My Drive"
        },
        "folderId": {
          "__rl": true,
          "value": "1iMD0rI-mNEVO8ja9mq-tJCv_ZnhI8xDr",
          "mode": "list",
          "cachedResultName": "documentos_usuarios",
          "cachedResultUrl": "https://drive.google.com/drive/folders/1iMD0rI-mNEVO8ja9mq-tJCv_ZnhI8xDr"
        },
        "options": {
          "appPropertiesUi": {
            "appPropertyValues": [
              {
                "key": "numero_usuario",
                "value": "={{ $('extraer').item.json.from }}"
              }
            ]
          }
        }
      },
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [
        700,
        920
      ],
      "id": "32565ea6-5868-4f7c-8763-407662347072",
      "name": "Google Drive"
    },
    {
      "parameters": {
        "resource": "media",
        "operation": "mediaUrlGet",
        "mediaGetId": "={{ $json.video.id }}"
      },
      "type": "n8n-nodes-base.whatsApp",
      "typeVersion": 1,
      "position": [
        0,
        380
      ],
      "id": "f550f7c3-de74-4c5b-80bf-1caf2c166325",
      "name": "Obtener video",
      "webhookId": "2b076a1b-b3f6-4c6e-8f2e-99d8d856424c"
    },
    {
      "parameters": {
        "url": "={{ $json.url }}",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "whatsAppApi",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        200,
        340
      ],
      "id": "34392fb6-9962-4ee5-a19b-bfb4ff02b2f9",
      "name": "HTTP Request4"
    },
    {
      "parameters": {
        "batchSize": 2,
        "options": {}
      },
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [
        880,
        820
      ],
      "id": "1e0f3ad0-df00-432d-9c37-cf9f5620a11c",
      "name": "Loop Over Items1"
    },
    {
      "parameters": {
        "operation": "send",
        "phoneNumberId": "583933854796648",
        "recipientPhoneNumber": "={{ $('Dirigir').item.json.from }}",
        "textBody": "Su documento fue procesado con exito. Si quiere saber algo relacionado al mismo por favor continue su consulta al siguiente numero: 111111100020",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.whatsApp",
      "typeVersion": 1,
      "position": [
        1180,
        900
      ],
      "id": "6fe57424-72ea-4cec-93d2-9a39ce7cbf48",
      "name": "usuario1",
      "webhookId": "5ad00db1-14ae-48b3-bdce-2cf6ee0043a9"
    },
    {
      "parameters": {
        "operation": "send",
        "phoneNumberId": "583933854796648",
        "recipientPhoneNumber": "={{ $('Dirigir').item.json.from }}",
        "textBody": "=Hola!!, el usuario con el numero de telefono {{ $('Dirigir').item.json.from }} a mandado el siguiente documento: {{ $json.url }}, por favor escribele lo mas pronto posible y comprueba si su consulta o orden fue culminada de manera exitosa.",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.whatsApp",
      "typeVersion": 1,
      "position": [
        1160,
        1080
      ],
      "id": "69957bc7-db8b-4b3b-8034-66e08f70c081",
      "name": "moderador1",
      "webhookId": "f878b0a2-ffac-4d70-ab30-91cf87004943"
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.noOp",
      "name": "Replace Me1",
      "typeVersion": 1,
      "position": [
        1140,
        760
      ],
      "id": "3a48acd1-b5c8-4f48-b896-4c0b9e739121"
    },
    {
      "parameters": {
        "resource": "audio",
        "operation": "transcribe",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.openAi",
      "typeVersion": 1.8,
      "position": [
        460,
        300
      ],
      "id": "dc04f932-1e06-428c-a7eb-693e5c199b62",
      "name": "OpenAI"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $json.text }}",
        "messages": {
          "messageValues": [
            {
              "message": "Eres una cadena que tiene como prop√≥sito principal analizar el input que te da el nodo anterior. Este mismo te dar√° el texto transcrito de un video y debes asegurarte que est√© video tenga un contenido en texto v√°lido. En caso de no tener contexto suficiente o responder algo sin mucho contexto como \"you\", o \"bon appeti\" o algo similar debes responder \"el usuario no dio suficiente contexto en su mensaje, pregunta amablemente en que puedes ayudarlo. En caso contrario en el que la transcripci√≥n arroja un texto con detalles de lo que quiere o consulta el usuario, pasa la transcripci√≥n tal como est√°."
            }
          ]
        }
      },
      "type": "@n8n/n8n-nodes-langchain.chainLlm",
      "typeVersion": 1.5,
      "position": [
        700,
        320
      ],
      "id": "1a78f9f0-1038-4be5-a2d0-582741c92aab",
      "name": "Basic LLM Chain1"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.1,
      "position": [
        780,
        540
      ],
      "id": "91b77fad-03ec-4c86-8035-0ab26c37741f",
      "name": "OpenAI Chat Model2"
    },
    {
      "parameters": {
        "name": "agendar_citas",
        "description": "usa esta herramienta para agendar citas en la medida que los usuarios lo soliciten",
        "workflowId": {
          "__rl": true,
          "value": "tsXf23H9MIdkwMXr",
          "mode": "list",
          "cachedResultName": "agendar_citas_realtime"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {
            "dia": "={{ $fromAI('dia','aqui debe ir el d√≠a en el que el usuario desea agendar la cita, debe ir el este formato: YY/MM/DD') }}",
            "hora": "={{ $fromAI('hora','aqui debe ir la hora en la que el usuario desea agendar la cita') }}",
            "acompa√±antes": "={{ $fromAI('acompnantes','aqui debe ir el numero de acompa√±antes que tendra el usuario') }}",
            "consulta": "={{ $fromAI('consulta','aqui debe ir el motivo de la cita con detalles extras que de el usuario') }}",
            "correo_electronico": "={{ $fromAI('correo_electronico','aqui debe ir el correo electronico del usuario') }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "correo_electronico",
              "displayName": "correo_electronico",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            },
            {
              "id": "dia",
              "displayName": "dia",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            },
            {
              "id": "hora",
              "displayName": "hora",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            },
            {
              "id": "acompa√±antes",
              "displayName": "acompa√±antes",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            },
            {
              "id": "consulta",
              "displayName": "consulta",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        }
      },
      "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
      "typeVersion": 2,
      "position": [
        2140,
        780
      ],
      "id": "b8a91b87-b532-449f-81c2-7232a7815ae9",
      "name": "citas"
    }
  ],
  "connections": {
    "base de conocimientos": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Productos": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "cotizaciones": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Postgres Chat Memory": {
      "ai_memory": [
        [
          {
            "node": "AI Agent",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "WhatsApp Trigger": {
      "main": [
        [
          {
            "node": "extraer",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "extraer": {
      "main": [
        [
          {
            "node": "Dirigir",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Dirigir": {
      "main": [
        [
          {
            "node": "obtener audio",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Obtener imagen",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Obtener video",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Wait",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "WhatsApp Business Cloud",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTTP Request": {
      "main": [
        [
          {
            "node": "Basic LLM Chain",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model1": {
      "ai_languageModel": [
        [
          {
            "node": "Basic LLM Chain",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Basic LLM Chain": {
      "main": [
        [
          {
            "node": "Mensaje final",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "obtener audio": {
      "main": [
        [
          {
            "node": "HTTP Request1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTTP Request1": {
      "main": [
        [
          {
            "node": "transcribir audio",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "transcribir audio": {
      "main": [
        [
          {
            "node": "Mensaje final",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Mensaje final": {
      "main": [
        [
          {
            "node": "AI Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent": {
      "main": [
        [
          {
            "node": "Mensaje final1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Wait": {
      "main": [
        [
          {
            "node": "Edit Fields",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields": {
      "main": [
        [
          {
            "node": "Mensaje final",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Obtener imagen": {
      "main": [
        [
          {
            "node": "HTTP Request",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "WhatsApp Business Cloud": {
      "main": [
        [
          {
            "node": "HTTP Request2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTTP Request2": {
      "main": [
        [
          {
            "node": "Google Drive",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Drive": {
      "main": [
        [
          {
            "node": "Loop Over Items1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Obtener video": {
      "main": [
        [
          {
            "node": "HTTP Request4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTTP Request4": {
      "main": [
        [
          {
            "node": "OpenAI",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Loop Over Items1": {
      "main": [
        [
          {
            "node": "Replace Me1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "usuario1",
            "type": "main",
            "index": 0
          },
          {
            "node": "moderador1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI": {
      "main": [
        [
          {
            "node": "Basic LLM Chain1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model2": {
      "ai_languageModel": [
        [
          {
            "node": "Basic LLM Chain1",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Basic LLM Chain1": {
      "main": [
        [
          {
            "node": "Mensaje final",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "citas": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    }
  },
  "settings": {
    "executionOrder": "v1"
  },
  "staticData": null,
  "meta": null,
  "pinData": {
    "WhatsApp Trigger": [
      {
        "json": {
          "messaging_product": "whatsapp",
          "metadata": {
            "display_phone_number": "15551476697",
            "phone_number_id": "583933854796648"
          },
          "contacts": [
            {
              "profile": {
                "name": "Panomada"
              },
              "wa_id": "584143249677"
            }
          ],
          "messages": [
            {
              "from": "584143249677",
              "id": "wamid.HBgMNTg0MTQzMjQ5Njc3FQIAEhggQkFENTA3MUZDRTg3QjJCMEZCOUQ2MkFEQkExQUExMzcA",
              "timestamp": "1738564151",
              "text": {
                "body": "H"
              },
              "type": "text"
            }
          ],
          "field": "messages"
        }
      }
    ]
  },
  "versionId": "364daea4-8531-4486-8b2d-83e6b25d3f1b",
  "triggerCount": 0,
  "tags": []
}